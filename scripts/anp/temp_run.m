% MATLAB script to test compute_t_R function

% Initialize parameters
clc
clear

% point_num = 50;
% P_W = randn(3,point_num)*5 + randn(3,point_num)*5;

P_W = [
    -0.73551238, -0.78118074, -1.69086969,  1.82645702,  1.61762846,  0.753883  ,  0.95702285,  0.3082487 , -0.50389582, -0.77042562, -1.34752023,  0.56313092,  2.09759974, -0.05106884,  0.97354203,  2.0338192 , -1.25295126,  1.18398035, -0.15580471,  0.6671564 ,  0.5833928 , -0.9142952 ,  0.96047026,  0.94290197, -0.12518187,  1.02438521, -2.12233973, -0.75305557,  0.90937901;
     5.07160997,  4.06462431,  4.40920782,  4.04454041,  4.09644222,  2.31490397,  1.37838936,  4.73850679,  3.15025473,  2.14143443,  4.61606884,  2.99997115,  4.09572172,  0.65428174,  3.47797823,  4.52106762,  3.06919909,  3.59053254,  2.23380876,  4.95108843,  3.78203821,  2.478338  ,  4.65014696,  3.49452162,  3.91423082,  4.6142211 ,  4.51770592,  4.44417667,  4.31394911;
    -0.41982976, -0.38334644, -0.17856155,  0.09593417,  0.93814778,  0.58545303,  0.74550223,  0.71726167,  0.43299642, -0.08076227,  0.70441121,  0.12128959,  0.3754721 ,  0.52398193,  0.56393188,  0.53701097,  0.63171345,  1.01903784,  0.19425119,  0.08018826,  1.04325831,  0.39668149, -0.4360598 ,  1.08682835,  0.48751777, -0.33221188, -0.92763418,  0.65935677,  0.51926494
];
% point_num = 50;
% P_W = randn(3,point_num)*5 + randn(3,point_num)*5;

T = [
    -4.44089210e-16, -9.95496806e-01, -9.47950939e-02,  0.00000000e+00;
     9.99506619e-01, -2.97740981e-03,  3.12674616e-02, -5.27963268e-01;
    -3.14089020e-02, -9.47483238e-02,  9.95005646e-01,  4.05062356e-01;
     0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00
];

R_SW = T(1:3,1:3);
t_S = T(1:3,4);

P_S_est = R_SW'*(P_W - t_S);

d = vecnorm(P_S_est);
tan_theta = P_S_est(2,:)./P_S_est(1,:);
cos_theta = P_S_est(1,:)./vecnorm(P_S_est(1:2,:));
sin_theta = P_S_est(2,:)./vecnorm(P_S_est(1:2,:));
theta_est = atan(tan_theta);

P_SI(1,:) = d.*cos_theta;
P_SI(2,:) = d.*sin_theta;


cmp = [
    5.65156872,  4.64865802,  4.95943541,  4.59072795,  4.63140251,  2.84215206,  1.91423048,  5.27288472,  3.68037743,  2.7015463 ,  5.16348736,  3.54212102,  4.62296155,  1.18875121,  4.00326963,  5.04318531,  3.61425571,  4.14090481,  2.76915477,  5.49071203,  4.34561199,  3.00961072,  5.25648455,  4.05864923,  4.44351207,  5.20463047,  5.16165623,  4.98438708,  4.83912361;
    0.79775741,  0.84479053,  1.72606951, -1.80679612, -1.68408395, -0.77778286, -1.00084666, -0.35338262,  0.48867259,  0.8105016 ,  1.30571249, -0.54529195, -2.09940219,  0.03638271, -0.99720769, -2.05251693,  1.22392412, -1.26241454,  0.16698225, -0.65017673, -0.66288039,  0.90338062, -0.90121321, -1.03034951,  0.10372178, -0.97304683,  2.25754036,  0.71401633, -0.93113402
];

disp(P_SI-cmp);

[ R_sw_nonapp,t_s_nonapp] = Wang_nonapp_algorithm_5( P_SI,P_W,R_SW);
[ R_sw_nonapp_py,t_s_nonapp_py] = Wang_nonapp_algorithm_5(cmp,P_W, R_SW);

R_sw_nonapp = R_sw_nonapp';
R_sw_nonapp_py = R_sw_nonapp_py';

% [ R_sw_app,t_s_app] = Wang_app_algorithm(P_W, P_SI,-R_SW'*t_S,0);


% Display results
disp('nonapp with no noise:');
disp(R_sw_nonapp);
disp(t_s_nonapp);


disp('nonapp with noise:');
disp(R_sw_nonapp_py);
disp(t_s_nonapp_py);


