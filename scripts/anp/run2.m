% MATLAB script to test compute_t_R function

% Initialize parameters
clc
clear


%    P_W = [ 6.3723361 ,  4.5240402 ,  6.76254577,  6.25698193,  7.79260445,...
%          6.72762702,  7.60267654,  7.08325777,  7.66213854,  7.23866499,...
%          3.50257951,  6.4859005 ,  7.71081349,  5.81442691,  3.34292972,...
%          5.00638702,  7.20522162,  4.29802294,  7.5583895 ,  6.42820651;
%        -2.41570381, -0.69241184,  0.03362135, -0.81518972, -0.01676097,...
%         -0.46288979, -1.31933768, -0.73648026, -0.35025381, -2.76620607,...
%         -0.11115857, -0.76333301,  0.69313454, -1.26736277, -0.87691552,...
%          0.12607952, -2.14465185,  0.02662272,  1.64634791,  1.31753699;
%        -0.5415008 , -0.88246241, -0.11896007, -0.28181641, -0.90820135,...
%         -1.2712701 , -0.28216007, -1.4478447 , -1.30231427,  0.30042688,...
%         -0.54460507, -0.43337675, -0.42835824, -0.10344146, -0.4873707 ,...
%         -1.09733627, -0.60270704, -0.47601693, -0.47785228, -0.45450962];
% 
%     T = [ 0.98006778,  0.19166309,  0.05227235,  1.99314574;
%        -0.19820337,  0.96123914,  0.19166309, -0.20221549;
%        -0.01351149, -0.19820337,  0.98006778, -0.49885762;
%         0.        ,  0.        ,  0.        ,  1.        ];


% point_num = 50;
% P_W = randn(3,point_num)*5 + randn(3,point_num)*5;
% isRotationMatrix(R_SW )
% R_SW = [ 0.99015653, -0.09001756,  0.10717691;
%          0.10717691,  0.98012199, -0.16695508;
%         -0.09001756,  0.17679855,  0.98012199];

P_W = [ 2.13603473, -0.77186602,  1.95072114,  1.82645702,  0.80637312,...
     0.34877479,  1.43712997,  1.12189889,  1.95998657,  0.54235911,...
     1.3069241 , -0.50389582, -0.77042562,  0.56313092,  2.09759974,...
     1.93175828,  0.97354203,  1.29132247,  2.18199611,  0.91832501,...
     1.60884869, -0.6045416 ,  2.45790458, -0.15580471,  1.31191647,...
    -0.9142952 ,  2.26811886,  2.21745372, -0.04960047,  1.02438521,...
     1.28548098,  2.00271249,  0.90937901;
   1.6240803 ,  0.60711432,  1.76001179,  4.04454041,  2.19236112,...
     0.5548203 ,  0.32810998,  0.69382906,  2.48453283,  1.49465704,...
     3.06561542,  3.15025473,  2.14143443,  2.99997115,  4.09572172,...
     0.40185145,  3.47797823,  0.44462281,  0.18353406,  1.21580398,...
     2.54795504,  1.46164775,  1.08357716,  2.23380876,  2.69423199,...
     2.478338  ,  1.88500488,  1.7469312 ,  1.33389342,  4.6142211 ,...
    -0.0169981 ,  0.15571359,  4.31394911;
   -1.36646855, -0.03994431,  0.15434559,  0.09593417, -0.25782672,...
    -0.38742959, -0.24006221, -0.15651231, -0.18151858, -0.71256626,...
    -0.83193976,  0.43299642, -0.08076227,  0.12128959,  0.3754721 ,...
    -0.86207271,  0.56393188, -0.48081446, -0.20747855, -0.77819484,...
    -1.04896271, -0.43491939, -0.75536293,  0.19425119, -0.68284667,...
     0.39668149,  0.18036377, -1.16874087, -0.45922306, -0.33221188,...
    -1.37119341, -1.44178295,  0.51926494];

T = [ 0.98013292, -0.12185598,  0.15649465, -3.15206827;
    0.14159372,  0.98239622, -0.12185598,  1.4993604 ;
   -0.13889087,  0.14159372,  0.98013292,  0.35867805;
    0.        ,  0.        ,  0.        ,  1.        ];
R_SW = T(1:3,1:3)
t_S = T(1:3,4)

P_S_est = R_SW'*(P_W - t_S);

d = vecnorm(P_S_est);
tan_theta = P_S_est(2,:)./P_S_est(1,:);
cos_theta = P_S_est(1,:)./vecnorm(P_S_est(1:2,:));
sin_theta = P_S_est(2,:)./vecnorm(P_S_est(1:2,:));
theta_est = atan(tan_theta);

P_SI(1,:) = d.*cos_theta;
P_SI(2,:) = d.*sin_theta;

problem = [5.50942394,  2.26334397,  5.09808267,  5.28025929,  4.06413938, ...
           3.40175754,  4.42263585,  4.1539959 ,  5.22717707,  3.79775534, ...
           4.80177714,  2.83091042,  2.4899579 ,  3.89016058,  5.53265619, ...
           5.00323703,  4.33335864,  4.3223673 ,  5.13675371,  4.12990089, ...
           5.0678441 ,  2.62781294,  5.59664686,  3.07124033,  4.71218092, ...
           2.34079955,  5.42802975,  5.55215595,  3.144372  ,  4.64416485, ...
           4.43447706,  5.16396097,  4.37514435;
          -0.77586546, -1.22378091, -0.39711938,  1.85783519,  0.11116443, ...
          -1.4604042 , -1.79759567, -1.38759336,  0.26851777, -0.61109297, ...
           0.83443091,  1.31519536,  0.27874408,  0.98870703,  1.92096431, ...
          -1.87287748,  1.48314561, -1.69649089, -2.02926995, -0.94069357, ...
           0.25355444, -0.46444643, -1.25032097,  0.3339592 ,  0.48477078, ...
           0.698661  , -0.30893246, -0.63216348, -0.65922136,  2.46052488, ...
          -2.30630768, -2.22538054,  2.30242561];
% d = vecnorm(P_S_est);
% tan_theta = P_S_est(2,:)./P_S_est(1,:);
% temp = vecnorm(P_S_est(1:2,:));
% theta_est = atan(tan_theta);
% P_SI(1,:) = d.*cos(theta_est);
% P_SI(2,:) = d.*sin(theta_est);


[ R_sw_cal,t_s_cal] = compute_t_R(P_W, P_SI,0,0);
[ R_sw_nonapp,t_s_nonapp] = Wang_nonapp_algorithm(P_W, P_SI,R_SW);
[ R_sw_app,t_s_app] = Wang_app_algorithm(P_W, P_SI,-R_SW'*t_S,0);


% Display results
disp('t_s_cal:');
disp(t_s_cal);

disp('R_sw_cal:');
disp(R_sw_cal);

% Display results
disp('t_s_cal:');
disp(t_s_cal);

disp('R_sw_cal:');
disp(R_sw_cal);

error_t_my_app = norm(t_s_app-t_S)
