% MATLAB script to test compute_t_R function

% Initialize parameters
clc
clear

point_num = 20;
% P_W = randn(3,point_num)*5 + randn(3,point_num)*5;

% P_W = [
%    -1.38660717, -2.35341692, -2.17523289, -1.25887418, -1.76831245,  0.58669752,  1.18843973, -0.1515867 ,  0.67467397, -1.67420828, -2.77094769, -1.23726094, -1.33151364, -2.67628932, -0.01532792, -2.08085012, -2.86501884, -0.68202037, -2.38799381, -2.54970336, -0.42283136, -0.64948553;
%    -2.12936354, -1.1439904 , -1.2776773 , -1.77900851, -5.2710743 , -3.24825454, -2.67612004, -2.27082896, -1.9069531 , -1.96464503, -1.04094589, -0.80463147, -5.04669428, -2.70052958, -2.13126016, -2.91140866, -1.70948327, -2.033741  , -3.73906279, -5.07786322, -1.568964  , -2.75520921;
%     0.8920483 ,  1.48197484,  1.88178122,  0.62711102,  1.54477298,  1.02458489,  0.89946163,  1.04464602,  0.80771899,  1.49477398,  0.72021079,  0.55844587,  0.98681056,  1.94200408,  1.00018442,  0.53257984,  0.10973129,  0.89233363,  0.90292549,  0.5518285 ,  1.14766133,  0.50296474
% ];
% T = [
%    -9.95039499e-01, -8.36952708e-04,  9.94771124e-02,  2.61197551e+00;
%    -1.21701694e-16, -9.99964608e-01, -8.41322257e-03, -3.00000000e+00;
%     9.94806332e-02, -8.37148877e-03,  9.95004282e-01,  4.91586678e-01;
%     0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00
% ];
P_W = [
    3.39461163,  1.39550166,  0.74243717,  2.90571484,  1.06152158, ...
    2.55713872,  1.83619628,  4.43347954,  2.54160729,  1.45648787, ...
    3.158429  ,  1.98502214,  2.30279989,  1.99917682,  0.33536854, ...
    1.02929976,  2.0769054 ,  2.2390387 ,  1.28009858,  2.49243876, ...
    1.88864529;

   -3.83726733, -4.99174544, -3.72639523, -4.36980523, -3.12773574, ...
   -3.06542161, -3.59780313, -4.46925097, -2.86482133, -3.57781254, ...
   -4.86986645, -4.58842932, -4.83047604, -4.73959574, -4.32062428, ...
   -3.99266059, -1.65911354, -2.69220341, -3.77607002, -4.55296597, ...
   -4.18078314;

    0.42368991, -0.23083743,  0.01049521,  0.76560405, -0.41846748, ...
    0.62141558, -0.05664566,  0.56119596, -0.03302974, -0.25989743, ...
    0.13457851, -0.2048321 ,  0.92602874,  0.43819447,  0.25120063, ...
    0.86600469,  0.51760116,  0.36589892,  0.04717307,  0.93970545, ...
    0.89948555
];

T = [
   -2.22044605e-16,  9.96224899e-01, -8.68098519e-02,  2.81642007e+00;
   -9.98777728e-01, -4.29077036e-03, -4.92406354e-02,  4.91597708e-01;
   -4.94272282e-02,  8.67037466e-02,  9.95007241e-01,  5.86919256e-01;
    0.00000000e+00,  0.00000000e+00,  0.00000000e+00,  1.00000000e+00
];

R_SW = T(1:3,1:3)
t_S = T(1:3,4)

P_S_est = R_SW'*(P_W - t_S);
d = vecnorm(P_S_est);
tan_theta = P_S_est(2,:)./P_S_est(1,:);
cos_theta = P_S_est(1,:)./vecnorm(P_S_est(1:2,:));
sin_theta = P_S_est(2,:)./vecnorm(P_S_est(1:2,:));
theta_est = atan(tan_theta);
P_SI(1,:) = d.*cos_theta;
P_SI(2,:) = d.*sin_theta;
 



% [ R_sw_cal,t_s_cal] = compute_t_R(P_W, P_SI,0,0);
% [ R_sw_app,t_s_app] = Wang_app_algorithm(P_W, P_SI,-R_SW'*t_S,0);

P_SI = [
    4.33164695,  5.53198263,  4.24456221,  4.86387016,  3.71337646, ...
    3.55850236,  4.13051666,  4.97553362,  3.40968375,  4.13612088, ...
    5.38156951,  5.13349848,  5.33749383,  5.23518937,  4.82407258, ...
    4.5063413 ,  2.15365299,  3.19088187,  4.29299581,  5.05991582, ...
    4.69115346;

    0.58040319, -1.46695446, -2.09973675,  0.12577734, -1.84416304, ...
   -0.24058785, -1.01833043,  1.58095163, -0.31556801, -1.42099593, ...
    0.32479339, -0.87862627, -0.46284691, -0.80509424, -2.48072253, ...
   -1.75305399, -0.73422094, -0.58069016, -1.56035428, -0.27267107, ...
   -0.88469813
];
[ R_sw_nonapp,t_s_nonapp] = Wang_nonapp_algorithm(P_W, P_SI,R_SW);




% Display results
disp('nonapp with no noise:');
disp(R_sw_nonapp-R_SW);
disp(norm(t_s_nonapp-t_S));


