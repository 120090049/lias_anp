% MATLAB script to test compute_t_R function

% Initialize parameters
clc
clear

% P_W = [ 1.06468565,  2.31759309,  0.35106129,  3.633026  , -0.30355716,...
%         -1.99571699, -0.17747571,  1.88155627, -1.5290993 , -1.72765435,...
%          3.16261278,  4.63730969,  2.74471633,  3.97951076, -0.14802812,...
%          4.43218987,  4.04127959, -0.26189836,  0.912736  ,  2.6847464 ,...
%          0.3559706 , -0.81076358, -0.25064624, -1.85310636,  0.4857652 ,...
%          2.9175314 ,  2.15640638, -0.71552746,  3.78229859, -0.26303752,...
%          2.40594241,  2.68300674, -2.03231184,  0.5881672 ,  0.17541774;
%        2.15335171,  2.22427009,  0.13722424,  1.62571457,  2.30703358,...
%          1.62333665,  2.5212474 ,  2.93972395,  0.29379445,  0.85940493,...
%          0.78559129,  0.75710126,  2.36389638,  1.58152865,  1.96476345,...
%          0.70284667,  0.80582551,  2.11508347,  0.17749674,  0.90879937,...
%          2.60368177,  2.55750701,  2.09008228,  0.09527522,  0.07861022,...
%          2.42931478,  0.36894649,  0.96179572,  0.60865037,  1.34471242,...
%          2.44394798,  1.48191296,  2.30470538,  0.72382554,  2.55085797;
%         0.4460043 , -0.92815562, -0.36306902,  0.02044748, -0.01997227,...
%         -0.66784918,  0.30280853, -0.58435965, -0.4538    , -0.83419368,...
%          0.38298784, -0.31159393,  0.32168943, -0.10436606, -0.71233136,...
%         -0.93288816,  0.27015596, -0.99035812, -0.77765151, -0.565299  ,...
%         -0.38056115, -0.89752559, -0.637542  , -0.7976791 , -0.17864977,...
%          0.17748862, -0.25419538, -0.21643761, -0.83896555, -0.04488033,...
%         -0.14467027,  0.34145294, -0.1916855 , -0.94122864, -0.19017877];
% 
% 
% R_SW = [ 0.99015653, -0.09001756,  0.10717691;
%          0.10717691,  0.98012199, -0.16695508;
%         -0.09001756,  0.17679855,  0.98012199];
% 
% t_S = [-0.562109, 1.41947194, 0.58107842]';

P_W = [4.01398693, 4.14420807, 4.32659229, 3.57898031, 4.62524004, ...
       2.53439912, 2.37290791, 2.92203137, 4.74740917, 4.4339805, ...
       4.65539456, 2.69388094, 5.05178386, 2.2541195, 2.8000855, ...
       4.553101, 4.0377846, 3.54886843, 3.15894055, 3.86783644, ...
       3.225728, 4.81897145, 2.97160881, 2.66377559, 4.14797142, ...
       5.04479198, 4.91589477, 3.80825367, 2.33517812; 

       3.32507861, 2.98633423, 0.36589002, 1.76739533, 3.40097916, ...
       1.94232965, 1.42191891, -0.59761111, -0.97792378, 2.89282256, ...
       -1.10248539, -0.27824162, -0.71949274, 0.4283563, 2.29046146, ...
       1.71617653, 0.45081748, -0.02527929, -0.57252434, -0.10329507, ...
       2.70341004, -0.19826834, -0.45016959, 0.11943769, 1.48413903, ...
       -0.38693323, 0.03323147, -0.87652375, 2.02522025; 

       0.00793917, 0.11863106, 0.20218476, 0.45847291, 0.4032435, ...
       0.06235353, 0.34978184, -0.11087785, -0.38486538, 0.49727416, ...
       -0.50759619, -0.37549141, -0.51327746, 0.37311051, 0.11160917, ...
       0.14894067, 0.4736446, -0.13407187, 0.36255587, 0.45950438, ...
       0.50665149, -0.10995821, 0.20389852, 0.42015753, -0.28143116, ...
       -0.17127721, -0.17202155, -0.28689548, -0.04151965];

R_SW = [0.98007119, 0.19820539, 0.0132322; 
        -0.19686029, 0.96018782, 0.19820539; 
        0.02657998, -0.19686029, 0.98007119];

t_S = [-1.99112736; 0.13173626; -0.49556368];



P_S_est = R_SW*(P_W - t_S);
d = vecnorm(P_S_est);
tan_theta = P_S_est(2,:)./P_S_est(1,:);
theta_est = atan(tan_theta);
P_SI(1,:) = d.*cos(theta_est);
P_SI(2,:) = d.*sin(theta_est);

[ R_sw_cal,t_s_cal] = compute_t_R(P_W, P_SI,0,0);
disp('t_s_cal:');
disp(t_s_cal);
disp('R_sw_cal:');
disp(R_sw_cal);

[ R_sw_cal,t_s_cal] = Wang_nonapp_algorithm_2(P_W, P_SI);
disp('t_s_cal:');
disp(t_s_cal);
disp('R_sw_cal:');
disp(R_sw_cal);

t_s_true = -R_SW*t_S;
[ R_sw_cal,t_s_cal] = Wang_app_algorithm_2(P_W, P_SI, t_s_true ,0);
disp('t_s_cal:');
disp(t_s_cal);
disp('R_sw_cal:');
disp(R_sw_cal);

% % Noise data
% tan_theta_noise = tan_theta + randn() * 0.0005;
% theta_noise = atan(tan_theta_noise);
% d_noise = d + randn() * 0.0002;
% P_SI_Noise(1, :) = d_noise .* cos(theta_noise); % Matlab索引从1开始
% P_SI_Noise(2, :) = d_noise .* sin(theta_noise);
% % Call the compute_t_R function
% [ R_sw_cal,t_s_cal] = compute_t_R(P_W, P_SI_Noise,0,0);
% 
% % Display results
% disp('t_s_cal:');
% disp(t_s_cal);
% 
% disp('R_sw_cal:');
% disp(R_sw_cal);